### TCP 粘包问题

当客户端发送多个数据包给服务器时，服务器底层的 TCP 接收缓冲区受到的数据为粘在一起的。

TCP 底层通信是面向**字节流**的，面向连接的协议，TCP 保证发送数据的准确性和顺序性，字节流以字节为单位。

假设 TCP 缓冲区的大小为 10 个字节，当发送 4 个字节的数据（"aaaa"），缓冲区还剩余 6 个字节的空闲空间，再次发送 7 个字节的数据（"bbbbbbc"），则客户端第一次接受的数据是 `"aaaabbbbbb"` ，剩余 1 个字节的数据未发送，等待下一次发送。

### TCP 粘包产生的原因

1. 当客户端的发送频率远高于服务器的接受频率。
2. TCP 底层的安全和效率机制，其不允许字节数特别少的小包发送频率过高，TCP 会在底层累计到一定大小才一起发送。（*Nagle*）
3. 发送端的缓冲区中有上一次未发送完的数据，或接收端的缓冲区中有未取出的数据。

### TCP 黏包处理的方式

主要采用应用层定义**收发包格式**的方法，俗称切包处理，常用的协议： **TLV**（*Type Length Value*）协议。

```
+---------+---------+---------+
|  type   |  length |  value  |
+---------+---------+---------+
```

解包接受数据，打包发送数据。

