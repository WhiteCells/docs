[WSL Official Documents](https://learn.microsoft.com/zh-cn/windows/wsl/)

系统要求：Windows 10 版本 2004 及以上（内部版本 19041 及以上）或 Windows 11

以管理员打开 PowerShell

```powershell
# 启用适用于 Linux 的 Windows 子系统功能并重启
Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux
```

```sh
wsl --list --online # 查看可安装列表
wsl --install -d Ubuntu # 需要代理，否则很慢
wsl --set-version Ubuntu 2 # 切换 Ubuntu 为 wsl2
wsl --set-default-version 2 # WSL2 设为默认版本
wsl --set-default <linux-name> # 默认启动
wsl --unregister <linux-name> # 删除指定系统
wsl --shutdown # 关闭所有 WSL
```

WSL 中命令

```sh
explorer.exe . # 打开子系统当前路径

cd /mnt/ # 进入本地磁盘挂载
```

Linux 默认的 shell 在 gdb 调试时补全 program 会出现卡顿，考虑切换 shell

### Arch WSL2

[Github ArchWSL](https://github.com/yuk7/ArchWSL)

切换更新源

```sh
# 备份源
sudo cp vim /etc/pacman.d/mirrorlist vim /etc/pacman.d/mirrorlist.bak
```

`vim /etc/pacman.d/mirrorlist` 更换源写入：

```sh
Server = https://mirrors.tuna.tsinghua.edu.cn/archlinux/$repo/os/$arch
```

必要更新：

```sh
# 初始化 pacman 的密钥环
pacman-key --init

# 将 Arch Linux 官网软件库的 GPG 密钥添加到密钥环中
pacman-key --populate

# 更新包数据库，并更新 archlinux-keyring 包
pacman -Sy archlinux-keyring

# 更新已有包
pacman -Su
```

安装包：

```sh
pacman -S gcc
pacman -S make
pacman -S cmake
pacman -S man
pacman -S vim
pacman -S net-tools
pacman -S openssh
pacman -S tree
pacman -S zsh

pacman -S git
pacman -S base-devel
git clone https://aur.archlinux.org/yay.git
cd yay
# 防止 root 用户执行脚本时破坏系统
# 需使用普通用户执行构建命令
makepkg -si
```

#### 用户

修改 root 密码：

```sh
passwd
```

添加非 root 用户：

```sh
useradd -m -G wheel -s /bin/bash <username>
passwd <username>
```

取消文件 `/etc/sudoers` 中 `wheel ALL=(ALL) ALL` 的注释，或者：

```sh
echo "%wheel ALL=(ALL) ALL" > /etc/sudoers.d/wheel
```

退出 Arch 修改 Arch 默认用户：

```sh
# PowerShell 中，在 Arch WSL2 目录下
./Arch.ext config --default-user {username}
```

#### 备份

```sh
.\Arch.exe backup --tar
# 备份格式可选参数 tar tgz vhdx vhdxgz reg
```

恢复

```sh
# 从备份安装 wsl
.\Arch.exe install \path\backup.tar
```

#### 卸载

```sh
.\Arch.exe clean
```

### WSL2 DNS 解析问题

WSL2 使用的 DNS 解析服务器设置在文件 `/etc/resolv.conf` 中，这是 link 文件，源路径在 `/run/resolvconf/resolv.conf`，该文件在 wsl 启动时自动生成：

```sh
# This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:
# [network]
# generateResolvConf = false
nameserver 172.24.12.2
```

`nameserver` 指定 DNS 服务器地址，但是自动分配的地址是无法解析的，需要设置固定的 DNS 地址。

关闭 `nameserver` 的自动生成，向 `/etc/wsl.conf` 文件中添加：

```ini
[network]
generateResolvConf = false
```

关闭 WSL：

```sh
wsl --shutdown
```

重新启动后删除 link 文件 `/etc/resolv.conf`：

```sh
rm /etc/resolv.conf
```

新建 `/etc/resolv.conf`，并向文件中写入：

```sh
nameserver 114.114.114.114
```

### WSL2 网路访问配置

